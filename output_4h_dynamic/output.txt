<retrieval_status>success</retrieval_status>

<task_id>bbc2463</task_id>

<task_type>local_bash</task_type>

<status>completed</status>

<exit_code>0</exit_code>

<output>
[stderr] warning: `VIRTUAL_ENV=/nix/store/vxl8pzgkkw8vdb4agzwm58imrfclmfrx-python3-3.12.11` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead
============================================================
  4時間足 動的リバランス実験
  シナリオ比較: 0bps / 5bps / 15bps
============================================================

[Step 1] 4hデータ収集...
4hキャッシュからデータ読み込み中...
  98 銘柄 × 6780 本のデータ読み込み完了
  価格データ: 98 銘柄 × 6780 本

[Step 2] データ前処理...

Study Period 1 を準備中...
  SP1: 97 銘柄が利用可能
    訓練セット統計: mean=0.000218, std=0.020675
    訓練データ作成中...
    検証データ作成中...
    テストデータ作成中...
    テスト期間のバックテスト用データ作成中...
    サンプル数 - Train: 269173, Val: 86991, Test: 86743
    ラベル分布 - Train正例率: 0.503
    テスト期間: 900 日

Study Period 2 を準備中...
  SP2: 98 銘柄が利用可能
    訓練セット統計: mean=0.000368, std=0.020719
    訓練データ作成中...
    検証データ作成中...
    テストデータ作成中...
    テスト期間のバックテスト用データ作成中...
    サンプル数 - Train: 280084, Val: 86743, Test: 86577
    ラベル分布 - Train正例率: 0.503
    テスト期間: 900 日

Study Period 3 を準備中...
  SP3: 98 銘柄が利用可能
    訓練セット統計: mean=0.000134, std=0.023491
    訓練データ作成中...
    検証データ作成中...
    テストデータ作成中...
    テスト期間のバックテスト用データ作成中...
    サンプル数 - Train: 286334, Val: 86577, Test: 85323
    ラベル分布 - Train正例率: 0.503
    テスト期間: 898 日

[Step 3] 訓練・予測...

############################################################
  Study Period 1
  Test: 2024-11-17 ~ 2025-04-15
############################################################

  [1/3] ハイパーパラメータ探索...
    ユニット数 5 を検証中...
[stderr] 2026-02-10 08:11:45.450276: E external/local_xla/xla/stream_executor/cuda/cuda_platform.cc:51] failed call to cuInit: INTERNAL: CUDA error: Failed call to cuInit: UNKNOWN ERROR (303)
      検証精度: 0.5133
    ユニット数 10 を検証中...
      検証精度: 0.5116
    ユニット数 15 を検証中...
      検証精度: 0.5115
    ユニット数 20 を検証中...
      検証精度: 0.5116
    → 選択されたユニット数: 5 (検証精度: 0.5133)

  [2/3] アンサンブル訓練 (ユニット数=5)...
    アンサンブルモデル 1/10 (seed=7)
      検証精度: 0.5106
    アンサンブルモデル 2/10 (seed=49)
      検証精度: 0.5127
    アンサンブルモデル 3/10 (seed=91)
      検証精度: 0.5099
    アンサンブルモデル 4/10 (seed=133)
      検証精度: 0.5119
    アンサンブルモデル 5/10 (seed=175)
      検証精度: 0.5106
    アンサンブルモデル 6/10 (seed=217)
      検証精度: 0.5097
    アンサンブルモデル 7/10 (seed=259)
      検証精度: 0.5109
    アンサンブルモデル 8/10 (seed=301)
      検証精度: 0.5120
    アンサンブルモデル 9/10 (seed=343)
      検証精度: 0.5108
    アンサンブルモデル 10/10 (seed=385)
      検証精度: 0.5124

  [3/3] テスト期間の予測...
[stderr] WARNING:tensorflow:5 out of the last 9 calls to <function TensorFlowTrainer.make_predict_function.<locals>.one_step_on_data_distributed at 0x7fa71c455bc0> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
[stderr] WARNING:tensorflow:6 out of the last 12 calls to <function TensorFlowTrainer.make_predict_function.<locals>.one_step_on_data_distributed at 0x7fa71c455bc0> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
    予測完了: 900 期間分

############################################################
  Study Period 2
  Test: 2025-04-16 ~ 2025-09-12
############################################################

  [1/3] ハイパーパラメータ探索...
    ユニット数 5 を検証中...
      検証精度: 0.5153
    ユニット数 10 を検証中...
      検証精度: 0.5149
    ユニット数 15 を検証中...
      検証精度: 0.5156
    ユニット数 20 を検証中...
      検証精度: 0.5150
    → 選択されたユニット数: 15 (検証精度: 0.5156)

  [2/3] アンサンブル訓練 (ユニット数=15)...
    アンサンブルモデル 1/10 (seed=7)
      検証精度: 0.5158
    アンサンブルモデル 2/10 (seed=49)
      検証精度: 0.5146
    アンサンブルモデル 3/10 (seed=91)
      検証精度: 0.5159
    アンサンブルモデル 4/10 (seed=133)
      検証精度: 0.5148
    アンサンブルモデル 5/10 (seed=175)
      検証精度: 0.5136
    アンサンブルモデル 6/10 (seed=217)
      検証精度: 0.5133
    アンサンブルモデル 7/10 (seed=259)
      検証精度: 0.5150
    アンサンブルモデル 8/10 (seed=301)
      検証精度: 0.5151
    アンサンブルモデル 9/10 (seed=343)
      検証精度: 0.5161
    アンサンブルモデル 10/10 (seed=385)
      検証精度: 0.5110

  [3/3] テスト期間の予測...
    予測完了: 900 期間分

############################################################
  Study Period 3
  Test: 2025-09-13 ~ 2026-02-09
############################################################

  [1/3] ハイパーパラメータ探索...
    ユニット数 5 を検証中...
      検証精度: 0.5112
    ユニット数 10 を検証中...
      検証精度: 0.5119
    ユニット数 15 を検証中...
      検証精度: 0.5116
    ユニット数 20 を検証中...
      検証精度: 0.5132
    → 選択されたユニット数: 20 (検証精度: 0.5132)

  [2/3] アンサンブル訓練 (ユニット数=20)...
    アンサンブルモデル 1/10 (seed=7)
      検証精度: 0.5125
    アンサンブルモデル 2/10 (seed=49)
      検証精度: 0.5161
    アンサンブルモデル 3/10 (seed=91)
      検証精度: 0.5145
    アンサンブルモデル 4/10 (seed=133)
      検証精度: 0.5163
    アンサンブルモデル 5/10 (seed=175)
      検証精度: 0.5145
    アンサンブルモデル 6/10 (seed=217)
      検証精度: 0.5140
    アンサンブルモデル 7/10 (seed=259)
      検証精度: 0.5147
    アンサンブルモデル 8/10 (seed=301)
      検証精度: 0.5133
    アンサンブルモデル 9/10 (seed=343)
      検証精度: 0.5119
    アンサンブルモデル 10/10 (seed=385)
      検証精度: 0.5149

  [3/3] テスト期間の予測...
    予測完了: 898 期間分

============================================================
  シナリオ別バックテスト
============================================================

──────────────────────────────────────────────────
  シナリオ: 0bps + 動的リバランス
──────────────────────────────────────────────────

  SP1 バックテスト (0bps + 動的リバランス)...
    平均ターンオーバー: 3.9/10 銘柄/期間

==================================================
  パフォーマンス評価: SP1 0bps + 動的リバランス
==================================================
  日次平均リターン:     0.00134
  日次標準偏差:         0.01687
  VaR 1%:              -0.04638
  VaR 5%:              -0.02509
  CVaR 1%:             -0.06685
  CVaR 5%:             -0.04042
  年率ボラティリティ:   0.78928
  シャープレシオ:       3.7225
  ソルティノレシオ:     4.8155
  最大ドローダウン:     -0.2779
  精度:                 0.5591
  総リターン:           1.9390
==================================================

  SP2 バックテスト (0bps + 動的リバランス)...
    平均ターンオーバー: 4.0/10 銘柄/期間

==================================================
  パフォーマンス評価: SP2 0bps + 動的リバランス
==================================================
  日次平均リターン:     0.00101
  日次標準偏差:         0.01385
  VaR 1%:              -0.03775
  VaR 5%:              -0.02360
  CVaR 1%:             -0.05223
  CVaR 5%:             -0.03392
  年率ボラティリティ:   0.64818
  シャープレシオ:       3.4275
  ソルティノレシオ:     4.3985
  最大ドローダウン:     -0.2559
  精度:                 0.5589
  総リターン:           1.2840
==================================================

  SP3 バックテスト (0bps + 動的リバランス)...
    平均ターンオーバー: 4.1/10 銘柄/期間

==================================================
  パフォーマンス評価: SP3 0bps + 動的リバランス
==================================================
  日次平均リターン:     0.00052
  日次標準偏差:         0.01838
  VaR 1%:              -0.06909
  VaR 5%:              -0.02836
  CVaR 1%:             -0.08780
  CVaR 5%:             -0.05047
  年率ボラティリティ:   0.86002
  シャープレシオ:       1.3346
  ソルティノレシオ:     1.4538
  最大ドローダウン:     -0.5555
  精度:                 0.5645
  総リターン:           0.3717
==================================================

==================================================
  パフォーマンス評価: 全期間 0bps + 動的リバランス
==================================================
  日次平均リターン:     0.00096
  日次標準偏差:         0.01647
  VaR 1%:              -0.05033
  VaR 5%:              -0.02541
  CVaR 1%:             -0.07228
  CVaR 5%:             -0.04181
  年率ボラティリティ:   0.77068
  シャープレシオ:       2.7290
  ソルティノレシオ:     3.2455
  最大ドローダウン:     -0.5555
  精度:                 0.5608
  総リターン:           8.2075
==================================================

──────────────────────────────────────────────────
  シナリオ: 5bps + 動的リバランス
──────────────────────────────────────────────────

  SP1 バックテスト (5bps + 動的リバランス)...
    平均ターンオーバー: 3.9/10 銘柄/期間

==================================================
  パフォーマンス評価: SP1 5bps + 動的リバランス
==================================================
  日次平均リターン:     0.00095
  日次標準偏差:         0.01687
  VaR 1%:              -0.04698
  VaR 5%:              -0.02521
  CVaR 1%:             -0.06724
  CVaR 5%:             -0.04084
  年率ボラティリティ:   0.78927
  シャープレシオ:       2.6305
  ソルティノレシオ:     3.4038
  最大ドローダウン:     -0.2854
  精度:                 0.5591
  総リターン:           1.0630
==================================================

  SP2 バックテスト (5bps + 動的リバランス)...
    平均ターンオーバー: 4.0/10 銘柄/期間

==================================================
  パフォーマンス評価: SP2 5bps + 動的リバランス
==================================================
  日次平均リターン:     0.00061
  日次標準偏差:         0.01385
  VaR 1%:              -0.03854
  VaR 5%:              -0.02409
  CVaR 1%:             -0.05250
  CVaR 5%:             -0.03428
  年率ボラティリティ:   0.64817
  シャープレシオ:       2.0738
  ソルティノレシオ:     2.6677
  最大ドローダウン:     -0.2765
  精度:                 0.5589
  総リターン:           0.5929
==================================================

  SP3 バックテスト (5bps + 動的リバランス)...
    平均ターンオーバー: 4.1/10 銘柄/期間

==================================================
  パフォーマンス評価: SP3 5bps + 動的リバランス
==================================================
  日次平均リターン:     0.00012
  日次標準偏差:         0.01836
  VaR 1%:              -0.06968
  VaR 5%:              -0.02866
  CVaR 1%:             -0.08812
  CVaR 5%:             -0.05086
  年率ボラティリティ:   0.85931
  シャープレシオ:       0.3021
  ソルティノレシオ:     0.3309
  最大ドローダウン:     -0.5709
  精度:                 0.5645
  総リターン:           -0.0468
==================================================

==================================================
  パフォーマンス評価: 全期間 5bps + 動的リバランス
==================================================
  日次平均リターン:     0.00056
  日次標準偏差:         0.01646
  VaR 1%:              -0.05072
  VaR 5%:              -0.02588
  CVaR 1%:             -0.07264
  CVaR 5%:             -0.04219
  年率ボラティリティ:   0.77041
  シャープレシオ:       1.5931
  ソルティノレシオ:     1.9004
  最大ドローダウン:     -0.5941
  精度:                 0.5608
  総リターン:           2.1324
==================================================

──────────────────────────────────────────────────
  シナリオ: 15bps フルターンオーバー
──────────────────────────────────────────────────

  SP1 バックテスト (15bps フルターンオーバー)...

==================================================
  パフォーマンス評価: SP1 15bps フルターンオーバー
==================================================
  日次平均リターン:     -0.00182
  日次標準偏差:         0.01731
  VaR 1%:              -0.05345
  VaR 5%:              -0.02976
  CVaR 1%:             -0.07087
  CVaR 5%:             -0.04700
  年率ボラティリティ:   0.81014
  シャープレシオ:       -4.9291
  ソルティノレシオ:     -6.2470
  最大ドローダウン:     -0.8586
  精度:                 0.5536
  総リターン:           -0.8312
==================================================

  SP2 バックテスト (15bps フルターンオーバー)...

==================================================
  パフォーマンス評価: SP2 15bps フルターンオーバー
==================================================
  日次平均リターン:     -0.00175
  日次標準偏差:         0.01485
  VaR 1%:              -0.04779
  VaR 5%:              -0.02900
  CVaR 1%:             -0.05383
  CVaR 5%:             -0.03865
  年率ボラティリティ:   0.69505
  シャープレシオ:       -5.5092
  ソルティノレシオ:     -7.1383
  最大ドローダウン:     -0.8113
  精度:                 0.5670
  総リターン:           -0.8127
==================================================

  SP3 バックテスト (15bps フルターンオーバー)...

==================================================
  パフォーマンス評価: SP3 15bps フルターンオーバー
==================================================
  日次平均リターン:     -0.00255
  日次標準偏差:         0.01974
  VaR 1%:              -0.07353
  VaR 5%:              -0.03484
  CVaR 1%:             -0.09443
  CVaR 5%:             -0.05844
  年率ボラティリティ:   0.92370
  シャープレシオ:       -6.0391
  ソルティノレシオ:     -6.6930
  最大ドローダウン:     -0.9199
  精度:                 0.5653
  総リターン:           -0.9154
==================================================

==================================================
  パフォーマンス評価: 全期間 15bps フルターンオーバー
==================================================
  日次平均リターン:     -0.00204
  日次標準偏差:         0.01741
  VaR 1%:              -0.05679
  VaR 5%:              -0.03068
  CVaR 1%:             -0.07754
  CVaR 5%:             -0.04827
  年率ボラティリティ:   0.81478
  シャープレシオ:       -5.4814
  ソルティノレシオ:     -6.5335
  最大ドローダウン:     -0.9977
  精度:                 0.5620
  総リターン:           -0.9973
==================================================

============================================================
  シナリオ比較サマリー
============================================================

  シナリオ                        Sharpe       精度      総リターン     最大DD
  ────────────────────────────────────────────────────────────
  0bps + 動的リバランス                2.73   56.1%    820.8%  -55.5%
  5bps + 動的リバランス                1.59   56.1%    213.2%  -59.4%
  15bps フルターンオーバー              -5.48   56.2%    -99.7%  -99.8%

比較グラフ保存: /home/utyujin/Dev/stock/machine-learning/output_4h_dynamic/scenario_comparison.png

完了!
</output>
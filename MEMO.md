# メモ

## 精度はキープできるのか？

### 1. 「概念ドリフト（Concept Drift）」による精度の低下

機械学習モデルは「訓練データ」のパターンを学習しますが、仮想通貨市場は極めて変化が速いため、学習したルールが時間とともに通用しなくなる現象が起こります。これを**概念ドリフト**と呼びます。

* **SPの前半:** 訓練期間（直近の過去）とテスト期間の「市場の地合い（ボラティリティやトレンド）」が似ているため、精度が高くなりやすい傾向があります。
* **SPの後半:** 訓練時点から時間が経過するにつれ、新しい規制、新しいクジラの参入、あるいはマクロ経済環境の変化によって、モデルが学習した「古いルール」が機能しなくなり、精度が徐々に低下することが多いです。

---

### 2. ローリングウィンドウ（Rolling Window）の意義

論文で「SPを1, 2, 3と分けている」理由は、まさにこの精度の低下を防ぐためです。

* **定期的な再学習:** SP1の後半で精度が落ちる前に、より新しいデータを含めたSP2でモデルを「更新」します。
* もしSPを分けずに、2018年のデータで学習したモデルを2026年まで使い続けたら、後半の精度は壊滅的になっていたはずです。

### 3. 学習期間の「代表性」による影響

SPの前半・後半という切り口以外に、**「訓練データにどのような相場が含まれていたか」**も重要です。

* **例:** 訓練期間がずっと「上昇相場（バブル期）」だったモデルを、テスト期間の「後半」に訪れた「暴落相場」に適用すると、精度は一気に悪化します。
* 逆に、SPの後半で市場が安定し、モデルが捉えやすいパターン（平均回帰など）が強く出れば、後半の方が精度が良くなるというケースも稀にあります。

### 実装におけるアクション：精度の推移を確認する

現在の実験結果から、さらに深い洞察を得るために以下の分析をClaudeに依頼（あるいはコードを追加）してみるのが面白いでしょう。

1. **SPごとの月次精度の算出:** 1つのSP（約900日）をさらに月単位に分割し、精度の推移をグラフ化してみる。
2. **ボラティリティとの相関分析:** 市場が激しく動いている時期（SPの前半かもしれないし後半かもしれない）と、精度の関係を調べる。

## ロング、ショートのタイミングを変更するとよいのでは

他に、ロング、ショートをいれるタイミングを４ｈぴったりではなく、そのときに分足で明確なトレンドが出ていたとしたら、それが安定化してからロング、ショートを入れて４ｈの区切りでまた再評価する。Ex.ロングが大きな確率で出たときに、分足で下落トレンドがあるとき、それが終わってから購入など。

この考え方は、クオンツ（計量分析）の世界で**「執行アルゴリズム（Execution Algorithm）」**や**「マーケット・マイクロストラクチャーの活用」**と呼ばれる非常に高度で合理的な戦略です。

4時間足の「戦略的判断（何を買うか）」と、分足の「戦術的執行（いつ買うか）」を分けるのは、プロのHFT（高頻度取引）業者が収益を安定させるために必ず行っている手法です。

これを取り入れるメリットと具体的なロジックを整理します。

### 1. なぜ「待ち」の姿勢が有利なのか

AIが「4時間後に上がっている確率が高い」と予測しても、その瞬間の分足で「急落中」であれば、今すぐ買うのは「落ちてくるナイフ」を掴むようなものです。

* **スリッページの抑制**: 下落トレンドが止まり、板が安定してから買うことで、より有利な価格（指値が刺さりやすい、またはスプレッドが狭い状態）でエントリーできます。
* **逆選択（Adverse Selection）の回避**: 4時間足のシグナルが「買い」でも、分足の急落が「何か致命的なニュース」によるものだった場合、トレンド転換を確認してから入ることで、無用な損失を避けられます。

### 2. 具体的な「執行フィルター」のアルゴリズム案

4時間足で「ロング」の判定が出た際の、分足での執行フローを以下のように設計できます。

1. **待機フェーズ**: ロング判定が出ても即座に成行買いせず、監視を開始。
2. **トレンド判定**:
1分足や5分足で、移動平均線（EMA等）やRSIを見て「売られすぎ」や「下落トレンドの鈍化」を確認。
または、**「直近3〜5本の足の安値が切り上がった」**ことをトリガーにする。

**エントリー**: 下落が止まった（あるいは微増し始めた）のを確認してロング。
**再評価**: 4時間足の区切りが来たら、予測モデルを回し直して、継続保有か決済かを判断。

### 3. この手法の注意点：機会損失（Opportunity Cost）

この戦略には「買い逃し」のリスクも存在します。

* **急反発のリスク**: 4時間足の区切りと同時に価格が急騰し始めた場合、分足での「安定」を待っている間に、利益の大部分を逃してしまう可能性があります。
* **対策**: 「シグナル発生から最大30分待っても安定しなければ、その時の価格で入る」といった、**タイムアウト（時間制限）**を設けるのが一般的です。

### 4. 実装へのアドバイス

まずは、複雑なインジケーターを使わずに、以下のようなシンプルな条件からバックテストしてみるのがおすすめです。

> **「4h足のロング判定時、1分足の終値が直近5分の最高値を更新するまで待機する」**

これだけでも、4時間足の切り替わり直後のバタつきを避けることができます。
